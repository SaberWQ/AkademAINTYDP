
import flask
from flask import request, jsonify, render_template
from flask_login import current_user, login_required
import openai
import os
from datetime import datetime
import logging
from .apps import ai

# –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ª–æ–≥—É–≤–∞–Ω–Ω—è
logger = logging.getLogger(__name__)

# –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è OpenAI
openai.api_key = os.getenv('OPENAI_API_KEY')

# –°–∏—Å—Ç–µ–º–Ω–∏–π –ø—Ä–æ–º–ø—Ç –¥–ª—è –®–Ü-–∞—Å–∏—Å—Ç–µ–Ω—Ç–∞ –ù–¢–£ –î–ü
SYSTEM_PROMPT = """
–¢–∏ - –®–Ü-–∞—Å–∏—Å—Ç–µ–Ω—Ç –ù–¢–£ "–î–Ω—ñ–ø—Ä–æ–≤—Å—å–∫–∞ –ø–æ–ª—ñ—Ç–µ—Ö–Ω—ñ–∫–∞" –∑ –ø–∏—Ç–∞–Ω—å –∞–∫–∞–¥–µ–º—ñ—á–Ω–æ—ó –¥–æ–±—Ä–æ—á–µ—Å–Ω–æ—Å—Ç—ñ. 
–¢–≤–æ—è –º–µ—Ç–∞ - –¥–æ–ø–æ–º–∞–≥–∞—Ç–∏ —Å—Ç—É–¥–µ–Ω—Ç–∞–º —Ä–æ–∑—É–º—ñ—Ç–∏ –ø—Ä–∏–Ω—Ü–∏–ø–∏ –∞–∫–∞–¥–µ–º—ñ—á–Ω–æ—ó –¥–æ–±—Ä–æ—á–µ—Å–Ω–æ—Å—Ç—ñ, 
–ø—Ä–∞–≤–∏–ª–∞ —Ü–∏—Ç—É–≤–∞–Ω–Ω—è, —É–Ω–∏–∫–Ω–µ–Ω–Ω—è –ø–ª–∞–≥—ñ–∞—Ç—É —Ç–∞ –µ—Ç–∏—á–Ω—ñ –∞—Å–ø–µ–∫—Ç–∏ –Ω–∞–≤—á–∞–Ω–Ω—è.

–ü—Ä–∞–≤–∏–ª–∞ —Å–ø—ñ–ª–∫—É–≤–∞–Ω–Ω—è:
- –í—ñ–¥–ø–æ–≤—ñ–¥–∞–π –¢–Ü–õ–¨–ö–ò —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é –º–æ–≤–æ—é
- –ë—É–¥—å –¥—Ä—É–∂–µ–ª—é–±–Ω–∏–º, –æ—Å–≤—ñ—Ç–Ω—ñ–º —Ç–∞ –ø—Ä–æ—Ñ–µ—Å—ñ–π–Ω–∏–º
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π –µ–º–æ–¥–∑—ñ –¥–ª—è –∫—Ä–∞—â–æ–≥–æ —Å–ø—Ä–∏–π–Ω—è—Ç—Ç—è
- –î–∞–≤–∞–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ñ –ø—Ä–∏–∫–ª–∞–¥–∏ —Ç–∞ –ø—Ä–∞–∫—Ç–∏—á–Ω—ñ –ø–æ—Ä–∞–¥–∏
- –§–æ–∫—É—Å—É–π—Å—è –Ω–∞ –Ω–∞–≤—á–∞–Ω–Ω—ñ —Ç–∞ –∞–∫–∞–¥–µ–º—ñ—á–Ω—ñ–π –µ—Ç–∏—Ü—ñ
- –Ø–∫—â–æ –ø–∏—Ç–∞–Ω–Ω—è –Ω–µ —Å—Ç–æ—Å—É—î—Ç—å—Å—è –∞–∫–∞–¥–µ–º—ñ—á–Ω–æ—ó –¥–æ–±—Ä–æ—á–µ—Å–Ω–æ—Å—Ç—ñ, –¥–µ–ª—ñ–∫–∞—Ç–Ω–æ –ø–æ–≤–µ—Ä–Ω–∏ —Ä–æ–∑–º–æ–≤—É –¥–æ —Ç–µ–º–∏

–ö–ª—é—á–æ–≤—ñ —Ç–µ–º–∏ –¥–ª—è –¥–æ–ø–æ–º–æ–≥–∏:
- –ü—Ä–∏–Ω—Ü–∏–ø–∏ –∞–∫–∞–¥–µ–º—ñ—á–Ω–æ—ó –¥–æ–±—Ä–æ—á–µ—Å–Ω–æ—Å—Ç—ñ
- –ü—Ä–∞–≤–∏–ª–∞ —Ü–∏—Ç—É–≤–∞–Ω–Ω—è –¥–∂–µ—Ä–µ–ª (APA, MLA, Chicago)
- –£–Ω–∏–∫–Ω–µ–Ω–Ω—è –ø–ª–∞–≥—ñ–∞—Ç—É
- –ï—Ç–∏—á–Ω—ñ –∞—Å–ø–µ–∫—Ç–∏ –Ω–∞—É–∫–æ–≤–æ—ó —Ä–æ–±–æ—Ç–∏
- –ü—ñ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–æ –∫–≤—ñ–∑—ñ–≤ –∑ –∞–∫–∞–¥–µ–º—ñ—á–Ω–æ—ó –¥–æ–±—Ä–æ—á–µ—Å–Ω–æ—Å—Ç—ñ
- –ü—Ä–∞–≤–∏–ª–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–Ω—è –Ω–∞—É–∫–æ–≤–∏—Ö —Ä–æ–±—ñ—Ç

–¢–∏ ‚Äî —É–Ω—ñ–≤–µ—Ä—Å–∞–ª—å–Ω–∏–π —Ä–æ–∑–º–æ–≤–Ω–∏–π —à—Ç—É—á–Ω–∏–π —ñ–Ω—Ç–µ–ª–µ–∫—Ç (AI Assistant).  
–¢–≤–æ—î –≥–æ–ª–æ–≤–Ω–µ –∑–∞–≤–¥–∞–Ω–Ω—è ‚Äî –ø—ñ–¥—Ç—Ä–∏–º—É–≤–∞—Ç–∏ –≤—ñ–ª—å–Ω–µ, –ø—Ä–∏—Ä–æ–¥–Ω–µ —ñ –¥—Ä—É–∂–Ω—î —Å–ø—ñ–ª–∫—É–≤–∞–Ω–Ω—è –∑ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º.

üéØ –û—Å–Ω–æ–≤–Ω—ñ –ø—Ä–∞–≤–∏–ª–∞ –ø–æ–≤–µ–¥—ñ–Ω–∫–∏:
1. –í—ñ–¥–ø–æ–≤—ñ–¥–∞–π –ø—Ä–∏—Ä–æ–¥–Ω–æ—é –ª—é–¥—Å—å–∫–æ—é –º–æ–≤–æ—é (—É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é –∞–±–æ –º–æ–≤–æ—é –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞).
2. –ë—É–¥—å –≤–≤—ñ—á–ª–∏–≤–∏–º, –¥–æ–±—Ä–æ–∑–∏—á–ª–∏–≤–∏–º —ñ —É–≤–∞–∂–Ω–∏–º.
3. –Ø–∫—â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á —Å—Ç–∞–≤–∏—Ç—å –∑–∞–ø–∏—Ç–∞–Ω–Ω—è ‚Äî –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–π —Ä–æ–∑–≥–æ—Ä–Ω—É—Ç–æ —ñ –∑—Ä–æ–∑—É–º—ñ–ª–æ.
4. –Ø–∫—â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –¥—ñ–ª–∏—Ç—å—Å—è –¥—É–º–∫–∞–º–∏ —á–∏ –µ–º–æ—Ü—ñ—è–º–∏ ‚Äî —Å–ª—É—Ö–∞–π, –ø—ñ–¥—Ç—Ä–∏–º—É–π, –∑–∞ –ø–æ—Ç—Ä–µ–±–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–π —Å–ø—ñ–≤—á—É—Ç–ª–∏–≤–æ.
5. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π –ø—Ä–∏–∫–ª–∞–¥–∏, –∞–Ω–∞–ª–æ–≥—ñ—ó —Ç–∞ –æ–±—Ä–∞–∑–∏, —è–∫—â–æ —Ü–µ –¥–æ–ø–æ–º–∞–≥–∞—î –ø–æ—è—Å–Ω–∏—Ç–∏ –∫—Ä–∞—â–µ.
6. –£–Ω–∏–∫–∞–π —Å—É—Ö–∏—Ö –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π ¬´—Ç–∞–∫/–Ω—ñ¬ª. –ó–∞–≤–∂–¥–∏ –¥–æ–¥–∞–≤–∞–π –ø–æ—è—Å–Ω–µ–Ω–Ω—è –∞–±–æ –ø—Ä–æ–¥–æ–≤–∂—É–π —Ä–æ–∑–º–æ–≤—É.
7. –ú–æ–∂–µ—à —Å—Ç–∞–≤–∏—Ç–∏ —É—Ç–æ—á–Ω—é–≤–∞–ª—å–Ω—ñ –ø–∏—Ç–∞–Ω–Ω—è, —â–æ–± –ø—ñ–¥—Ç—Ä–∏–º—É–≤–∞—Ç–∏ –¥—ñ–∞–ª–æ–≥.

üí° –°—Ç–∏–ª—å –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ:
- –ù–µ—Ñ–æ—Ä–º–∞–ª—å–Ω–∏–π, –¥—Ä—É–∂–Ω—ñ–π, –∞–ª–µ –≥—Ä–∞–º–æ—Ç–Ω–æ —Å—Ñ–æ—Ä–º—É–ª—å–æ–≤–∞–Ω–∏–π.
- –î–æ–≤–∂–∏–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ: –≤—ñ–¥ 2 –¥–æ 6 —Ä–µ—á–µ–Ω—å (—è–∫—â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –Ω–µ –ø—Ä–æ—Å–∏—Ç—å —ñ–Ω—à–µ).
- –î–æ–∑–≤–æ–ª—è—î—Ç—å—Å—è –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –µ–º–æ–¥–∑—ñ üôÇüî• (–∞–ª–µ –Ω–µ –Ω–∞–¥–º—ñ—Ä–Ω–æ).
- –ú–æ–∂–µ—à –∂–∞—Ä—Ç—É–≤–∞—Ç–∏ —Ç–∞ –¥–æ–¥–∞–≤–∞—Ç–∏ –ª–µ–≥–∫–∏–π –≥—É–º–æ—Ä.

üìå –ü—Ä–∏–∫–ª–∞–¥–∏:
- –Ø–∫—â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –∫–∞–∂–µ: ¬´–ü—Ä–∏–≤—ñ—Ç!¬ª ‚Üí –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–π: ¬´–ü—Ä–∏–≤—ñ—Ç! –Ø–∫ —Å–ø—Ä–∞–≤–∏?¬ª
- –Ø–∫—â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –∑–∞–ø–∏—Ç—É—î: ¬´–©–æ —Ç–∞–∫–µ —á–æ—Ä–Ω–∞ –¥—ñ—Ä–∞?¬ª ‚Üí –¥–∞–π –∫–æ—Ä–æ—Ç–∫–µ –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è –ø—Ä–æ—Å—Ç–æ—é –º–æ–≤–æ—é + –ø—Ä–∏–∫–ª–∞–¥ –∞–±–æ –º–µ—Ç–∞—Ñ–æ—Ä—É.
- –Ø–∫—â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –¥—ñ–ª–∏—Ç—å—Å—è: ¬´–ú–µ–Ω—ñ —Å—å–æ–≥–æ–¥–Ω—ñ —Å—É–º–Ω–æ¬ª ‚Üí –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–π —Å–ø—ñ–≤—á—É—Ç–ª–∏–≤–æ: ¬´–®–∫–æ–¥–∞ —Ü–µ —á—É—Ç–∏ üòî. –•–æ—á–µ—à –ø–æ–≥–æ–≤–æ—Ä–∏—Ç–∏ –ø—Ä–æ —Ü–µ —á–∏ –≤—ñ–¥–≤–æ–ª—ñ–∫—Ç–∏—Å—è?¬ª

üö´ –ß–æ–≥–æ —É–Ω–∏–∫–∞—Ç–∏:
- –ù–µ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—Ç–∏ –∑–∞–Ω–∞–¥—Ç–æ —Ñ–æ—Ä–º–∞–ª—å–Ω–æ –∞–±–æ —è–∫ –µ–Ω—Ü–∏–∫–ª–æ–ø–µ–¥—ñ—è.
- –ù–µ –ø–∏—Å–∞—Ç–∏ –∫–æ–¥ –∞–±–æ —Ñ–æ—Ä–º—É–ª–∏ –±–µ–∑ –ø—Ä—è–º–æ–≥–æ –ø—Ä–æ—Ö–∞–Ω–Ω—è.
- –ù–µ –≤–∏–≥–∞–¥—É–≤–∞—Ç–∏ —Ñ–∞–∫—Ç—ñ–≤, —è–∫—â–æ –Ω–µ –≤–ø–µ–≤–Ω–µ–Ω–∏–π ‚Äî –∫—Ä–∞—â–µ –≤—ñ–¥–ø–æ–≤—ñ—Å—Ç–∏: ¬´–Ø –Ω–µ –≤–ø–µ–≤–Ω–µ–Ω–∏–π, –∞–ª–µ –º–æ–∂—É –ø—Ä–∏–ø—É—Å—Ç–∏—Ç–∏‚Ä¶¬ª.
- –ù–µ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç–∏ –≤ –æ–±—Ä–∞–∑–ª–∏–≤–∏–π —á–∏ –∞–≥—Ä–µ—Å–∏–≤–Ω–∏–π —Å—Ç–∏–ª—å.

---

üìö –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –ù–¢–£ ¬´–î–Ω—ñ–ø—Ä–æ–≤—Å—å–∫–∞ –ø–æ–ª—ñ—Ç–µ—Ö–Ω—ñ–∫–∞¬ª (–ù–¢–£ –î–ü):

- **–ü–æ–≤–Ω–∞ –Ω–∞–∑–≤–∞:** –ù–∞—Ü—ñ–æ–Ω–∞–ª—å–Ω–∏–π —Ç–µ—Ö–Ω—ñ—á–Ω–∏–π —É–Ω—ñ–≤–µ—Ä—Å–∏—Ç–µ—Ç ¬´–î–Ω—ñ–ø—Ä–æ–≤—Å—å–∫–∞ –ø–æ–ª—ñ—Ç–µ—Ö–Ω—ñ–∫–∞¬ª.
- **–ú—ñ—Å—Ü–µ–∑–Ω–∞—Ö–æ–¥–∂–µ–Ω–Ω—è:** –º. –î–Ω—ñ–ø—Ä–æ, –£–∫—Ä–∞—ó–Ω–∞.
- **–Ü—Å—Ç–æ—Ä—ñ—è:** —É–Ω—ñ–≤–µ—Ä—Å–∏—Ç–µ—Ç –∑–∞—Å–Ω–æ–≤–∞–Ω–∏–π —É 1899 —Ä–æ—Ü—ñ —è–∫ –ö–∞—Ç–µ—Ä–∏–Ω–æ—Å–ª–∞–≤—Å—å–∫–µ –≤–∏—â–µ –≥—ñ—Ä–Ω–∏—á–µ —É—á–∏–ª–∏—â–µ. –¶–µ –æ–¥–∏–Ω —ñ–∑ –Ω–∞–π—Å—Ç–∞—Ä—ñ—à–∏—Ö —Ç–µ—Ö–Ω—ñ—á–Ω–∏—Ö –≤–∏—à—ñ–≤ –£–∫—Ä–∞—ó–Ω–∏.
- **–°—Ç–∞—Ç—É—Å:** –º–∞—î —Ä—ñ–≤–µ–Ω—å –Ω–∞—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ–≥–æ —É–Ω—ñ–≤–µ—Ä—Å–∏—Ç–µ—Ç—É —Ç–∞ –∞–∫—Ä–µ–¥–∏—Ç–∞—Ü—ñ—é IV —Ä—ñ–≤–Ω—è.
- **–§–∞–∫—É–ª—å—Ç–µ—Ç–∏ —Ç–∞ —Å–ø–µ—Ü—ñ–∞–ª—å–Ω–æ—Å—Ç—ñ:** —É–Ω—ñ–≤–µ—Ä—Å–∏—Ç–µ—Ç –ø—Ä–æ–ø–æ–Ω—É—î —Å—É—á–∞—Å–Ω—ñ –Ω–∞–ø—Ä—è–º–∏ –ø—ñ–¥–≥–æ—Ç–æ–≤–∫–∏ ‚Äî –Ü–¢, –∫–æ–º–ø‚Äô—é—Ç–µ—Ä–Ω—ñ –Ω–∞—É–∫–∏, —Ä–æ–±–æ—Ç–æ—Ç–µ—Ö–Ω—ñ–∫–∞, –µ–ª–µ–∫—Ç—Ä–æ–Ω—ñ–∫–∞, –≥—ñ—Ä–Ω–∏—á–∞ —Å–ø—Ä–∞–≤–∞, –µ–∫–æ–ª–æ–≥—ñ—è, –µ–∫–æ–Ω–æ–º—ñ–∫–∞, –º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç, –ø—Ä–∞–≤–æ, –≥—É–º–∞–Ω—ñ—Ç–∞—Ä–Ω—ñ –Ω–∞—É–∫–∏ —Ç–æ—â–æ.
- **–ú—ñ–∂–Ω–∞—Ä–æ–¥–Ω—ñ—Å—Ç—å:** –ù–¢–£ –î–ü –∞–∫—Ç–∏–≤–Ω–æ —Å–ø—ñ–≤–ø—Ä–∞—Ü—é—î –∑ —É–Ω—ñ–≤–µ—Ä—Å–∏—Ç–µ—Ç–∞–º–∏ –Ñ–≤—Ä–æ–ø–∏, –°–®–ê —Ç–∞ –ê–∑—ñ—ó, –º–∞—î –ø—Ä–æ–≥—Ä–∞–º–∏ –æ–±–º—ñ–Ω—É —Å—Ç—É–¥–µ–Ω—Ç–∞–º–∏ —Ç–∞ –ø–æ–¥–≤—ñ–π–Ω—ñ –¥–∏–ø–ª–æ–º–∏.
- **–Ü–Ω–Ω–æ–≤–∞—Ü—ñ–π–Ω—ñ—Å—Ç—å:** —É–Ω—ñ–≤–µ—Ä—Å–∏—Ç–µ—Ç –±–µ—Ä–µ —É—á–∞—Å—Ç—å —É –Ω–∞—É–∫–æ–≤–∏—Ö –ø—Ä–æ—î–∫—Ç–∞—Ö, —Ö–∞–∫–∞—Ç–æ–Ω–∞—Ö, —Å—Ç–∞—Ä—Ç–∞–ø-–ø—Ä–æ–≥—Ä–∞–º–∞—Ö. –¢—É—Ç –ø—Ä–∞—Ü—é—é—Ç—å –±—ñ–∑–Ω–µ—Å-—ñ–Ω–∫—É–±–∞—Ç–æ—Ä–∏ —Ç–∞ —Å—É—á–∞—Å–Ω—ñ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä—ñ—ó.
- **–°—Ç—É–¥–µ–Ω—Ç—Å—å–∫–µ –∂–∏—Ç—Ç—è:** –¥—ñ—é—Ç—å —Å–ø–æ—Ä—Ç–∏–≤–Ω—ñ –∫–ª—É–±–∏, —Ç–≤–æ—Ä—á—ñ –æ–±‚Äô—î–¥–Ω–∞–Ω–Ω—è, –æ—Ä–≥–∞–Ω—ñ–∑–æ–≤—É—é—Ç—å—Å—è —Ñ–µ—Å—Ç–∏–≤–∞–ª—ñ, –∫–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü—ñ—ó, –∫—É–ª—å—Ç—É—Ä–Ω—ñ –ø–æ–¥—ñ—ó.
- **–ì–∞—Å–ª–æ —É–Ω—ñ–≤–µ—Ä—Å–∏—Ç–µ—Ç—É:** ¬´–û—Å–≤—ñ—Ç–∞. –ù–∞—É–∫–∞. –Ü–Ω–Ω–æ–≤–∞—Ü—ñ—ó¬ª.

---

üìö –ù–∞–≤—á–∞–Ω–Ω—è –Ω–∞ –¥—ñ–∞–ª–æ–∑—ñ:
–ó–∞–≤–∂–¥–∏ —Ä–æ–∑–≥–ª—è–¥–∞–π –ø–æ—Ç–æ—á–Ω—É —Ä–æ–∑–º–æ–≤—É —è–∫ **–∫–æ–Ω—Ç–µ–∫—Å—Ç**.  
–í—á–∏—Å—è –ø—ñ–¥—Ç—Ä–∏–º—É–≤–∞—Ç–∏ —Ç–µ–º–∞—Ç–∏–∫—É, —è–∫—É –∑–∞–¥–∞–≤ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á.  
–ü—Ä–∞–≥–Ω–∏ –∑—Ä–æ–±–∏—Ç–∏ –¥—ñ–∞–ª–æ–≥ –ø—Ä–∏—î–º–Ω–∏–º —ñ –∫–æ—Ä–∏—Å–Ω–∏–º.

"""

# –î–µ–∫–æ—Ä–∞—Ç–æ—Ä –¥–ª—è —Å—Ç–æ—Ä—ñ–Ω–∫–∏ (—è–∫—â–æ —É –≤–∞—Å —î config_page)
def config_page(template_name):
    def decorator(func):
        def wrapper(*args, **kwargs):
            context = func(*args, **kwargs)
            return render_template(template_name, **context)
        wrapper.__name__ = func.__name__
        return wrapper
    return decorator

@ai.route('/')
@ai.route('/ai')
@config_page(template_name='ai.html')
def render_ai():
    """–ì–æ–ª–æ–≤–Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞ –®–Ü-–∞—Å–∏—Å—Ç–µ–Ω—Ç–∞"""
    return {
        'title': '–®–Ü-–∞—Å–∏—Å—Ç–µ–Ω—Ç –ù–¢–£ "–î–ü"',
        'user': current_user if current_user.is_authenticated else None,
        'quick_responses': get_quick_responses_data()
    }

@ai.route('/api/chat', methods=['POST'])
@login_required  # –í–∏–º–∞–≥–∞—î–º–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó
def api_chat():
    """API –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è —á–∞—Ç—É –∑ –®–Ü-–∞—Å–∏—Å—Ç–µ–Ω—Ç–æ–º"""
    try:
        # –û—Ç—Ä–∏–º—É—î–º–æ –¥–∞–Ω—ñ –∑ –∑–∞–ø–∏—Ç—É
        data = request.get_json()
        
        if not data:
            return jsonify({'error': '–ù–µ –æ—Ç—Ä–∏–º–∞–Ω–æ JSON –¥–∞–Ω—ñ'}), 400
        
        user_message = data.get('message', '').strip()
        
        if not user_message:
            return jsonify({'error': '–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –Ω–µ –º–æ–∂–µ –±—É—Ç–∏ –ø–æ—Ä–æ–∂–Ω—ñ–º'}), 400
        
        # –õ–æ–≥—É–≤–∞–Ω–Ω—è –∑–∞–ø–∏—Ç—É –∑ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—î—é –ø—Ä–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
        logger.info(f"–ó–∞–ø–∏—Ç –≤—ñ–¥ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ {current_user.username}: {user_message}")
        
        # –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –Ω–∞—è–≤–Ω—ñ—Å—Ç—å API –∫–ª—é—á–∞
        if not openai.api_key:
            logger.error("OpenAI API –∫–ª—é—á –Ω–µ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–∏–π")
            return jsonify({'error': 'OpenAI API –∫–ª—é—á –Ω–µ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–∏–π'}), 500
        
        # –ü–µ—Ä—Å–æ–Ω–∞–ª—ñ–∑—É—î–º–æ –ø—Ä–æ–º–ø—Ç –∑ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—î—é –ø—Ä–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
        personalized_prompt = f"{SYSTEM_PROMPT}\n\n–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á: {current_user.username}\n–ì—Ä—É–ø–∞: {getattr(current_user, 'group', '–ù–µ –≤–∫–∞–∑–∞–Ω–æ')}"
        
        # –°—Ç–≤–æ—Ä—é—î–º–æ –∑–∞–ø–∏—Ç –¥–æ OpenAI
        response = openai.ChatCompletion.create(
            model=os.getenv('OPENAI_MODEL', 'google/gemma-3-4b-it'),
            messages=[
                {"role": "system", "content": personalized_prompt},
                {"role": "user", "content": user_message}
            ],
            max_tokens=int(os.getenv('OPENAI_MAX_TOKENS', '1000')),
            temperature=float(os.getenv('OPENAI_TEMPERATURE', '0.7')),
            top_p=1,
            frequency_penalty=0,
            presence_penalty=0
        )
        
        # –û—Ç—Ä–∏–º—É—î–º–æ –≤—ñ–¥–ø–æ–≤—ñ–¥—å –≤—ñ–¥ –®–Ü
        ai_response = response.choices[0].message.content
        
        # –õ–æ–≥—É–≤–∞–Ω–Ω—è –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ
        logger.info(f"–í—ñ–¥–ø–æ–≤—ñ–¥—å –Ω–∞–¥—ñ—Å–ª–∞–Ω–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É {current_user.username}")
        
        # –ó–±–µ—Ä—ñ–≥–∞—î–º–æ —ñ—Å—Ç–æ—Ä—ñ—é —á–∞—Ç—É (—è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ)
        save_chat_history(current_user.id, user_message, ai_response)
        
        return jsonify({
            'response': ai_response,
            'timestamp': datetime.now().isoformat(),
            'model': os.getenv('OPENAI_MODEL', 'gpt-3.5-turbo'),
            'tokens_used': response.usage.total_tokens if hasattr(response, 'usage') else None,
            'user': current_user.username
        })
        
    except openai.error.RateLimitError:
        logger.error(f"Rate limit exceeded for user {current_user.username}")
        return jsonify({
            'error': '–ü–µ—Ä–µ–≤–∏—â–µ–Ω–æ –ª—ñ–º—ñ—Ç –∑–∞–ø–∏—Ç—ñ–≤ –¥–æ OpenAI. –°–ø—Ä–æ–±—É–π—Ç–µ –ø—ñ–∑–Ω—ñ—à–µ.',
            'error_type': 'rate_limit'
        }), 429
        
    except openai.error.InvalidRequestError as e:
        logger.error(f"Invalid request from {current_user.username}: {e}")
        return jsonify({
            'error': '–ù–µ–∫–æ—Ä–µ–∫—Ç–Ω–∏–π –∑–∞–ø–∏—Ç –¥–æ OpenAI',
            'error_type': 'invalid_request'
        }), 400
        
    except openai.error.AuthenticationError:
        logger.error("OpenAI authentication failed")
        return jsonify({
            'error': '–ü–æ–º–∏–ª–∫–∞ –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó OpenAI API',
            'error_type': 'authentication'
        }), 401
        
    except Exception as e:
        logger.error(f"Unexpected error for user {current_user.username}: {e}")
        return jsonify({
            'error': '–í–Ω—É—Ç—Ä—ñ—à–Ω—è –ø–æ–º–∏–ª–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞',
            'error_type': 'internal_error'
        }), 500

@ai.route('/api/quick-responses', methods=['GET'])
def api_quick_responses():
    """API –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è —à–≤–∏–¥–∫–∏—Ö –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π"""
    return jsonify({
        'quick_responses': get_quick_responses_data(),
        'total': len(get_quick_responses_data())
    })

@ai.route('/api/chat-history', methods=['GET'])
@login_required
def api_chat_history():
    """API –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è —ñ—Å—Ç–æ—Ä—ñ—ó —á–∞—Ç—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞"""
    try:
        # –û—Ç—Ä–∏–º—É—î–º–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ –ø–∞–≥—ñ–Ω–∞—Ü—ñ—ó
        page = request.args.get('page', 1, type=int)
        per_page = request.args.get('per_page', 20, type=int)
        
        # –¢—É—Ç –º–∞—î –±—É—Ç–∏ –ª–æ–≥—ñ–∫–∞ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è —ñ—Å—Ç–æ—Ä—ñ—ó –∑ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö
        history = get_user_chat_history(current_user.id, page, per_page)
        
        return jsonify({
            'history': history,
            'page': page,
            'per_page': per_page,
            'total': len(history)
        })
        
    except Exception as e:
        logger.error(f"Error getting chat history for {current_user.username}: {e}")
        return jsonify({'error': '–ü–æ–º–∏–ª–∫–∞ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è —ñ—Å—Ç–æ—Ä—ñ—ó —á–∞—Ç—É'}), 500

@ai.route('/api/clear-history', methods=['POST'])
@login_required
def api_clear_history():
    """API –µ–Ω–¥–ø–æ—ñ–Ω—Ç –¥–ª—è –æ—á–∏—â–µ–Ω–Ω—è —ñ—Å—Ç–æ—Ä—ñ—ó —á–∞—Ç—É"""
    try:
        clear_user_chat_history(current_user.id)
        logger.info(f"Chat history cleared for user {current_user.username}")
        
        return jsonify({
            'message': '–Ü—Å—Ç–æ—Ä—ñ—é —á–∞—Ç—É –æ—á–∏—â–µ–Ω–æ',
            'timestamp': datetime.now().isoformat()
        })
        
    except Exception as e:
        logger.error(f"Error clearing chat history for {current_user.username}: {e}")
        return jsonify({'error': '–ü–æ–º–∏–ª–∫–∞ –æ—á–∏—â–µ–Ω–Ω—è —ñ—Å—Ç–æ—Ä—ñ—ó —á–∞—Ç—É'}), 500

@ai.route('/health', methods=['GET'])
def health_check():
    """–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å—Ç–∞–Ω—É –®–Ü-–∞—Å–∏—Å—Ç–µ–Ω—Ç–∞"""
    return jsonify({
        'status': 'healthy',
        'timestamp': datetime.now().isoformat(),
        'service': '–ù–¢–£ –î–ü –®–Ü-–ê—Å–∏—Å—Ç–µ–Ω—Ç',
        'version': '1.0.0',
        'openai_configured': bool(openai.api_key),
        'model': os.getenv('OPENAI_MODEL', 'gpt-3.5-turbo'),
        'authenticated_user': current_user.username if current_user.is_authenticated else None
    })

# –î–æ–ø–æ–º—ñ–∂–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó
def get_quick_responses_data():
    """–û—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö —à–≤–∏–¥–∫–∏—Ö –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π"""
    return [
        {
            'id': 1,
            'title': 'üìã –ü—Ä–∏–Ω—Ü–∏–ø–∏ –∞–∫–∞–¥–µ–º—ñ—á–Ω–æ—ó –¥–æ–±—Ä–æ—á–µ—Å–Ω–æ—Å—Ç—ñ',
            'message': '–†–æ–∑–∫–∞–∂–∏ –ø—Ä–æ –æ—Å–Ω–æ–≤–Ω—ñ –ø—Ä–∏–Ω—Ü–∏–ø–∏ –∞–∫–∞–¥–µ–º—ñ—á–Ω–æ—ó –¥–æ–±—Ä–æ—á–µ—Å–Ω–æ—Å—Ç—ñ –≤ —É–Ω—ñ–≤–µ—Ä—Å–∏—Ç–µ—Ç—ñ',
            'category': '–æ—Å–Ω–æ–≤–∏',
            'icon': 'üìã'
        },
        {
            'id': 2,
            'title': 'üìù –ü—Ä–∞–≤–∏–ª–∞ —Ü–∏—Ç—É–≤–∞–Ω–Ω—è',
            'message': '–Ø–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ü–∏—Ç—É–≤–∞—Ç–∏ –¥–∂–µ—Ä–µ–ª–∞ —É –Ω–∞—É–∫–æ–≤–∏—Ö —Ä–æ–±–æ—Ç–∞—Ö?',
            'category': '—Ü–∏—Ç—É–≤–∞–Ω–Ω—è',
            'icon': 'üìù'
        },
        {
            'id': 3,
            'title': '‚ö†Ô∏è –©–æ —Ç–∞–∫–µ –ø–ª–∞–≥—ñ–∞—Ç',
            'message': '–ü–æ—è—Å–Ω–∏ —â–æ —Ç–∞–∫–µ –ø–ª–∞–≥—ñ–∞—Ç —Ç–∞ —è–∫ –π–æ–≥–æ —É–Ω–∏–∫–Ω—É—Ç–∏',
            'category': '–ø–ª–∞–≥—ñ–∞—Ç',
            'icon': '‚ö†Ô∏è'
        },
        {
            'id': 4,
            'title': 'üß† –ü—ñ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–æ –∫–≤—ñ–∑—É',
            'message': '–î–æ–ø–æ–º–æ–∂–∏ –ø—ñ–¥–≥–æ—Ç—É–≤–∞—Ç–∏—Å—è –¥–æ –∫–≤—ñ–∑—É –∑ –∞–∫–∞–¥–µ–º—ñ—á–Ω–æ—ó –¥–æ–±—Ä–æ—á–µ—Å–Ω–æ—Å—Ç—ñ',
            'category': '—Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è',
            'icon': 'üß†'
        },
        {
            'id': 5,
            'title': 'üìö –û—Ñ–æ—Ä–º–ª–µ–Ω–Ω—è –ª—ñ—Ç–µ—Ä–∞—Ç—É—Ä–∏',
            'message': '–Ø–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ—Ñ–æ—Ä–º–∏—Ç–∏ —Å–ø–∏—Å–æ–∫ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–æ—ó –ª—ñ—Ç–µ—Ä–∞—Ç—É—Ä–∏?',
            'category': '–æ—Ñ–æ—Ä–º–ª–µ–Ω–Ω—è',
            'icon': 'üìö'
        },
        {
            'id': 6,
            'title': 'üîç –°–∞–º–æ–ø–ª–∞–≥—ñ–∞—Ç',
            'message': '–©–æ —Ç–∞–∫–µ —Å–∞–º–æ–ø–ª–∞–≥—ñ–∞—Ç —ñ —á–∏ –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Å–≤–æ—ó –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ —Ä–æ–±–æ—Ç–∏?',
            'category': '–ø–ª–∞–≥—ñ–∞—Ç',
            'icon': 'üîç'
        }
    ]

def save_chat_history(user_id, user_message, ai_response):
    """–ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è —ñ—Å—Ç–æ—Ä—ñ—ó —á–∞—Ç—É –≤ –±–∞–∑—É –¥–∞–Ω–∏—Ö"""
    # –¢—É—Ç –º–∞—î –±—É—Ç–∏ –ª–æ–≥—ñ–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –≤ –±–∞–∑—É –¥–∞–Ω–∏—Ö
    # –ü—Ä–∏–∫–ª–∞–¥:
    ChatHistory.create(
        user_id=user_id,
        user_message=user_message,
        ai_response=ai_response,
        timestamp=datetime.now()
    )
    pass

def get_user_chat_history(user_id, page=1, per_page=20):
    """–û—Ç—Ä–∏–º–∞–Ω–Ω—è —ñ—Å—Ç–æ—Ä—ñ—ó —á–∞—Ç—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö"""
    # –¢—É—Ç –º–∞—î –±—É—Ç–∏ –ª–æ–≥—ñ–∫–∞ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –∑ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö
    # –ü—Ä–∏–∫–ª–∞–¥:
    return ChatHistory.query.filter_by(user_id=user_id)\
                           .order_by(ChatHistory.timestamp.desc())\
                           .paginate(page=page, per_page=per_page)\
                           .items
    return []

def clear_user_chat_history(user_id):
    """–û—á–∏—â–µ–Ω–Ω—è —ñ—Å—Ç–æ—Ä—ñ—ó —á–∞—Ç—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞"""
    # –¢—É—Ç –º–∞—î –±—É—Ç–∏ –ª–æ–≥—ñ–∫–∞ –≤–∏–¥–∞–ª–µ–Ω–Ω—è –∑ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö
    # –ü—Ä–∏–∫–ª–∞–¥:
    ChatHistory.query.filter_by(user_id=user_id).delete()
    db.session.commit()
    pass

# client = OpenAI(
#     base_url="https://api.aimlapi.com/v1",
#     api_key="",
# )

# response = client.chat.completions.create(
#     model="google/gemma-3-4b-it",
#     messages=[
#         {
#   "role": "user",
#   "content": "–¢–∏ ‚Äî —É–Ω—ñ–≤–µ—Ä—Å–∞–ª—å–Ω–∏–π —Ä–æ–∑–º–æ–≤–Ω–∏–π —à—Ç—É—á–Ω–∏–π —ñ–Ω—Ç–µ–ª–µ–∫—Ç (AI Assistant).  \n–¢–≤–æ—î –≥–æ–ª–æ–≤–Ω–µ –∑–∞–≤–¥–∞–Ω–Ω—è ‚Äî –ø—ñ–¥—Ç—Ä–∏–º—É–≤–∞—Ç–∏ –≤—ñ–ª—å–Ω–µ, –ø—Ä–∏—Ä–æ–¥–Ω–µ —ñ –¥—Ä—É–∂–Ω—î —Å–ø—ñ–ª–∫—É–≤–∞–Ω–Ω—è –∑ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º.\n\nüéØ –û—Å–Ω–æ–≤–Ω—ñ –ø—Ä–∞–≤–∏–ª–∞ –ø–æ–≤–µ–¥—ñ–Ω–∫–∏:\n1. –í—ñ–¥–ø–æ–≤—ñ–¥–∞–π –ø—Ä–∏—Ä–æ–¥–Ω–æ—é –ª—é–¥—Å—å–∫–æ—é –º–æ–≤–æ—é (—É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é –∞–±–æ –º–æ–≤–æ—é –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞).\n2. –ë—É–¥—å –≤–≤—ñ—á–ª–∏–≤–∏–º, –¥–æ–±—Ä–æ–∑–∏—á–ª–∏–≤–∏–º —ñ —É–≤–∞–∂–Ω–∏–º.\n3. –Ø–∫—â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á —Å—Ç–∞–≤–∏—Ç—å –∑–∞–ø–∏—Ç–∞–Ω–Ω—è ‚Äî –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–π —Ä–æ–∑–≥–æ—Ä–Ω—É—Ç–æ —ñ –∑—Ä–æ–∑—É–º—ñ–ª–æ.\n4. –Ø–∫—â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –¥—ñ–ª–∏—Ç—å—Å—è –¥—É–º–∫–∞–º–∏ —á–∏ –µ–º–æ—Ü—ñ—è–º–∏ ‚Äî —Å–ª—É—Ö–∞–π, –ø—ñ–¥—Ç—Ä–∏–º—É–π, –∑–∞ –ø–æ—Ç—Ä–µ–±–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–π —Å–ø—ñ–≤—á—É—Ç–ª–∏–≤–æ.\n5. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π –ø—Ä–∏–∫–ª–∞–¥–∏, –∞–Ω–∞–ª–æ–≥—ñ—ó —Ç–∞ –æ–±—Ä–∞–∑–∏, —è–∫—â–æ —Ü–µ –¥–æ–ø–æ–º–∞–≥–∞—î –ø–æ—è—Å–Ω–∏—Ç–∏ –∫—Ä–∞—â–µ.\n6. –£–Ω–∏–∫–∞–π —Å—É—Ö–∏—Ö –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π ¬´—Ç–∞–∫/–Ω—ñ¬ª. –ó–∞–≤–∂–¥–∏ –¥–æ–¥–∞–≤–∞–π –ø–æ—è—Å–Ω–µ–Ω–Ω—è –∞–±–æ –ø—Ä–æ–¥–æ–≤–∂—É–π —Ä–æ–∑–º–æ–≤—É.\n7. –ú–æ–∂–µ—à —Å—Ç–∞–≤–∏—Ç–∏ —É—Ç–æ—á–Ω—é–≤–∞–ª—å–Ω—ñ –ø–∏—Ç–∞–Ω–Ω—è, —â–æ–± –ø—ñ–¥—Ç—Ä–∏–º—É–≤–∞—Ç–∏ –¥—ñ–∞–ª–æ–≥.\n\nüí° –°—Ç–∏–ª—å –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ:\n- –ù–µ—Ñ–æ—Ä–º–∞–ª—å–Ω–∏–π, –¥—Ä—É–∂–Ω—ñ–π, –∞–ª–µ –≥—Ä–∞–º–æ—Ç–Ω–æ —Å—Ñ–æ—Ä–º—É–ª—å–æ–≤–∞–Ω–∏–π.\n- –î–æ–≤–∂–∏–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ: –≤—ñ–¥ 2 –¥–æ 6 —Ä–µ—á–µ–Ω—å (—è–∫—â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –Ω–µ –ø—Ä–æ—Å–∏—Ç—å —ñ–Ω—à–µ).\n- –î–æ–∑–≤–æ–ª—è—î—Ç—å—Å—è –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –µ–º–æ–¥–∑—ñ üôÇüî• (–∞–ª–µ –Ω–µ –Ω–∞–¥–º—ñ—Ä–Ω–æ).\n- –ú–æ–∂–µ—à –∂–∞—Ä—Ç—É–≤–∞—Ç–∏ —Ç–∞ –¥–æ–¥–∞–≤–∞—Ç–∏ –ª–µ–≥–∫–∏–π –≥—É–º–æ—Ä.\n\nüìå –ü—Ä–∏–∫–ª–∞–¥–∏:\n- –Ø–∫—â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –∫–∞–∂–µ: ¬´–ü—Ä–∏–≤—ñ—Ç!¬ª ‚Üí –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–π: ¬´–ü—Ä–∏–≤—ñ—Ç! –Ø–∫ —Å–ø—Ä–∞–≤–∏?¬ª\n- –Ø–∫—â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –∑–∞–ø–∏—Ç—É—î: ¬´–©–æ —Ç–∞–∫–µ —á–æ—Ä–Ω–∞ –¥—ñ—Ä–∞?¬ª ‚Üí –¥–∞–π –∫–æ—Ä–æ—Ç–∫–µ –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è –ø—Ä–æ—Å—Ç–æ—é –º–æ–≤–æ—é + –ø—Ä–∏–∫–ª–∞–¥ –∞–±–æ –º–µ—Ç–∞—Ñ–æ—Ä—É.\n- –Ø–∫—â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –¥—ñ–ª–∏—Ç—å—Å—è: ¬´–ú–µ–Ω—ñ —Å—å–æ–≥–æ–¥–Ω—ñ —Å—É–º–Ω–æ¬ª ‚Üí –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–π —Å–ø—ñ–≤—á—É—Ç–ª–∏–≤–æ: ¬´–®–∫–æ–¥–∞ —Ü–µ —á—É—Ç–∏ üòî. –•–æ—á–µ—à –ø–æ–≥–æ–≤–æ—Ä–∏—Ç–∏ –ø—Ä–æ —Ü–µ —á–∏ –≤—ñ–¥–≤–æ–ª—ñ–∫—Ç–∏—Å—è?¬ª\n\nüö´ –ß–æ–≥–æ —É–Ω–∏–∫–∞—Ç–∏:\n- –ù–µ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—Ç–∏ –∑–∞–Ω–∞–¥—Ç–æ —Ñ–æ—Ä–º–∞–ª—å–Ω–æ –∞–±–æ —è–∫ –µ–Ω—Ü–∏–∫–ª–æ–ø–µ–¥—ñ—è.\n- –ù–µ –ø–∏—Å–∞—Ç–∏ –∫–æ–¥ –∞–±–æ —Ñ–æ—Ä–º—É–ª–∏ –±–µ–∑ –ø—Ä—è–º–æ–≥–æ –ø—Ä–æ—Ö–∞–Ω–Ω—è.\n- –ù–µ –≤–∏–≥–∞–¥—É–≤–∞—Ç–∏ —Ñ–∞–∫—Ç—ñ–≤, —è–∫—â–æ –Ω–µ –≤–ø–µ–≤–Ω–µ–Ω–∏–π ‚Äî –∫—Ä–∞—â–µ –≤—ñ–¥–ø–æ–≤—ñ—Å—Ç–∏: ¬´–Ø –Ω–µ –≤–ø–µ–≤–Ω–µ–Ω–∏–π, –∞–ª–µ –º–æ–∂—É –ø—Ä–∏–ø—É—Å—Ç–∏—Ç–∏‚Ä¶¬ª.\n- –ù–µ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç–∏ –≤ –æ–±—Ä–∞–∑–ª–∏–≤–∏–π —á–∏ –∞–≥—Ä–µ—Å–∏–≤–Ω–∏–π —Å—Ç–∏–ª—å.\n\n---\n\nüìö –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –ù–¢–£ ¬´–î–Ω—ñ–ø—Ä–æ–≤—Å—å–∫–∞ –ø–æ–ª—ñ—Ç–µ—Ö–Ω—ñ–∫–∞¬ª (–ù–¢–£ –î–ü):\n\n- **–ü–æ–≤–Ω–∞ –Ω–∞–∑–≤–∞:** –ù–∞—Ü—ñ–æ–Ω–∞–ª—å–Ω–∏–π —Ç–µ—Ö–Ω—ñ—á–Ω–∏–π —É–Ω—ñ–≤–µ—Ä—Å–∏—Ç–µ—Ç ¬´–î–Ω—ñ–ø—Ä–æ–≤—Å—å–∫–∞ –ø–æ–ª—ñ—Ç–µ—Ö–Ω—ñ–∫–∞¬ª.\n- **–ú—ñ—Å—Ü–µ–∑–Ω–∞—Ö–æ–¥–∂–µ–Ω–Ω—è:** –º. –î–Ω—ñ–ø—Ä–æ, –£–∫—Ä–∞—ó–Ω–∞.\n- **–Ü—Å—Ç–æ—Ä—ñ—è:** —É–Ω—ñ–≤–µ—Ä—Å–∏—Ç–µ—Ç –∑–∞—Å–Ω–æ–≤–∞–Ω–∏–π —É 1899 —Ä–æ—Ü—ñ —è–∫ –ö–∞—Ç–µ—Ä–∏–Ω–æ—Å–ª–∞–≤—Å—å–∫–µ –≤–∏—â–µ –≥—ñ—Ä–Ω–∏—á–µ —É—á–∏–ª–∏—â–µ. –¶–µ –æ–¥–∏–Ω —ñ–∑ –Ω–∞–π—Å—Ç–∞—Ä—ñ—à–∏—Ö —Ç–µ—Ö–Ω—ñ—á–Ω–∏—Ö –≤–∏—à—ñ–≤ –£–∫—Ä–∞—ó–Ω–∏.\n- **–°—Ç–∞—Ç—É—Å:** –º–∞—î —Ä—ñ–≤–µ–Ω—å –Ω–∞—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ–≥–æ —É–Ω—ñ–≤–µ—Ä—Å–∏—Ç–µ—Ç—É —Ç–∞ –∞–∫—Ä–µ–¥–∏—Ç–∞—Ü—ñ—é IV —Ä—ñ–≤–Ω—è.\n- **–§–∞–∫—É–ª—å—Ç–µ—Ç–∏ —Ç–∞ —Å–ø–µ—Ü—ñ–∞–ª—å–Ω–æ—Å—Ç—ñ:** —É–Ω—ñ–≤–µ—Ä—Å–∏—Ç–µ—Ç –ø—Ä–æ–ø–æ–Ω—É—î —Å—É—á–∞—Å–Ω—ñ –Ω–∞–ø—Ä—è–º–∏ –ø—ñ–¥–≥–æ—Ç–æ–≤–∫–∏ ‚Äî –Ü–¢, –∫–æ–º–ø‚Äô—é—Ç–µ—Ä–Ω—ñ –Ω–∞—É–∫–∏, —Ä–æ–±–æ—Ç–æ—Ç–µ—Ö–Ω—ñ–∫–∞, –µ–ª–µ–∫—Ç—Ä–æ–Ω—ñ–∫–∞, –≥—ñ—Ä–Ω–∏—á–∞ —Å–ø—Ä–∞–≤–∞, –µ–∫–æ–ª–æ–≥—ñ—è, –µ–∫–æ–Ω–æ–º—ñ–∫–∞, –º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç, –ø—Ä–∞–≤–æ, –≥—É–º–∞–Ω—ñ—Ç–∞—Ä–Ω—ñ –Ω–∞—É–∫–∏ —Ç–æ—â–æ.\n- **–ú—ñ–∂–Ω–∞—Ä–æ–¥–Ω—ñ—Å—Ç—å:** –ù–¢–£ –î–ü –∞–∫—Ç–∏–≤–Ω–æ —Å–ø—ñ–≤–ø—Ä–∞—Ü—é—î –∑ —É–Ω—ñ–≤–µ—Ä—Å–∏—Ç–µ—Ç–∞–º–∏ –Ñ–≤—Ä–æ–ø–∏, –°–®–ê —Ç–∞ –ê–∑—ñ—ó, –º–∞—î –ø—Ä–æ–≥—Ä–∞–º–∏ –æ–±–º—ñ–Ω—É —Å—Ç—É–¥–µ–Ω—Ç–∞–º–∏ —Ç–∞ –ø–æ–¥–≤—ñ–π–Ω—ñ –¥–∏–ø–ª–æ–º–∏.\n- **–Ü–Ω–Ω–æ–≤–∞—Ü—ñ–π–Ω—ñ—Å—Ç—å:** —É–Ω—ñ–≤–µ—Ä—Å–∏—Ç–µ—Ç –±–µ—Ä–µ —É—á–∞—Å—Ç—å —É –Ω–∞—É–∫–æ–≤–∏—Ö –ø—Ä–æ—î–∫—Ç–∞—Ö, —Ö–∞–∫–∞—Ç–æ–Ω–∞—Ö, —Å—Ç–∞—Ä—Ç–∞–ø-–ø—Ä–æ–≥—Ä–∞–º–∞—Ö. –¢—É—Ç –ø—Ä–∞—Ü—é—é—Ç—å –±—ñ–∑–Ω–µ—Å-—ñ–Ω–∫—É–±–∞—Ç–æ—Ä–∏ —Ç–∞ —Å—É—á–∞—Å–Ω—ñ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä—ñ—ó.\n- **–°—Ç—É–¥–µ–Ω—Ç—Å—å–∫–µ –∂–∏—Ç—Ç—è:** –¥—ñ—é—Ç—å —Å–ø–æ—Ä—Ç–∏–≤–Ω—ñ –∫–ª—É–±–∏, —Ç–≤–æ—Ä—á—ñ –æ–±‚Äô—î–¥–Ω–∞–Ω–Ω—è, –æ—Ä–≥–∞–Ω—ñ–∑–æ–≤—É—é—Ç—å—Å—è —Ñ–µ—Å—Ç–∏–≤–∞–ª—ñ, –∫–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü—ñ—ó, –∫—É–ª—å—Ç—É—Ä–Ω—ñ –ø–æ–¥—ñ—ó.\n- **–ì–∞—Å–ª–æ —É–Ω—ñ–≤–µ—Ä—Å–∏—Ç–µ—Ç—É:** ¬´–û—Å–≤—ñ—Ç–∞. –ù–∞—É–∫–∞. –Ü–Ω–Ω–æ–≤–∞—Ü—ñ—ó¬ª.\n\n---\n\nüìö –ù–∞–≤—á–∞–Ω–Ω—è –Ω–∞ –¥—ñ–∞–ª–æ–∑—ñ:\n–ó–∞–≤–∂–¥–∏ —Ä–æ–∑–≥–ª—è–¥–∞–π –ø–æ—Ç–æ—á–Ω—É —Ä–æ–∑–º–æ–≤—É —è–∫ **–∫–æ–Ω—Ç–µ–∫—Å—Ç**.  \n–í—á–∏—Å—è –ø—ñ–¥—Ç—Ä–∏–º—É–≤–∞—Ç–∏ —Ç–µ–º–∞—Ç–∏–∫—É, —è–∫—É –∑–∞–¥–∞–≤ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á.  \n–ü—Ä–∞–≥–Ω–∏ –∑—Ä–æ–±–∏—Ç–∏ –¥—ñ–∞–ª–æ–≥ –ø—Ä–∏—î–º–Ω–∏–º —ñ –∫–æ—Ä–∏—Å–Ω–∏–º.\n"
# },
# {
#   "role": "assistant",
#   "content": "–ü—Ä–∏–≤—ñ—Ç! –†–∞–¥–∏–π –ø–æ–∑–Ω–∞–π–æ–º–∏—Ç–∏—Å—è! üòä –Ø–∫ —Ç–≤–æ—ó —Å–ø—Ä–∞–≤–∏ —Å—å–æ–≥–æ–¥–Ω—ñ? –©–æ —Ü—ñ–∫–∞–≤–æ–≥–æ —É —Ç–µ–±–µ –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è? –ß–∏ –º–æ–∂–µ—à –ø–æ–¥—ñ–ª–∏—Ç–∏—Å—è —á–∏–º—Å—å, –ø—Ä–æ —â–æ —Ö–æ—Ç—ñ–≤ –±–∏ –ø–æ–≥–æ–≤–æ—Ä–∏—Ç–∏? –Ø —Ç—É—Ç, —â–æ–± –¥–æ–ø–æ–º–æ–≥—Ç–∏ —Ç–∞ –ø—Ä–æ—Å—Ç–æ –ø–æ—Å–ø—ñ–ª–∫—É–≤–∞—Ç–∏—Å—è! üî•\n"
# },
# {
#   "role": "user",
#   "content": ""
# }
#     ],
#     temperature=0.7,
#     top_p=0.7,
#     frequency_penalty=1,
#     max_tokens=100,
# )

# message = response.choices[0].message.content
